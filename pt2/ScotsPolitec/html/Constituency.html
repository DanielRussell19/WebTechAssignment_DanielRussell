<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="../css/Main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="height=device-height, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<body>

    <!-- ImageLogo -->
    <img src="../images/PlaceHolderLogo.jpg" alt="Logo" class="PageLogo" width="25%" height="25%" onclick="navHome()">

    <header>
    
        <!-- NavBar -->
        <div class="NavBar">
                    
            <nav>
                <ul>
                    <li><a href="Home.html">Home</a>|</li>
                    <li><a href="Map.html">Regional Map</a>|</li>
                    <li><a href="About.html">About</a></li>
                </ul>
            </nav>
                    
        </div>
                
    </header>
            
    <!-- ImageBanner -->
    <img src="../images/PlaceholderBanner.jpg" alt="Banner" class="PageBanner">

    <div class="BodyContent" style="width: 50%; text-align: center; float:left;">
        <h2 id="ConName"></h2><br>
        <h2 id="MspName">Name:</h2><br>
        <div id="MspImage">
        </div><br>
        <p id="MspParty"></p><br>
        <p id="MspEmail"></p><br>
        <p id="MspTele"></p><br>
        <p id="MspNotes"></p>
    </div>
    
    <div id="RegionMenu" style="display: inline-block; width: 50%; margin-top: 25%; margin-bottom: 20px; float: right;">
        <a onclick="">Job Statistics</a><br>
        <a onclick="">Education Statistics</a><br>
        <a onclick="">Health Statistics</a>
    </div>

    <footer>
        <div class="FooterContent">
            <a href="#AccessOptions">Accessability</a>
        <div id="AccessOptions">
            <!-- Accessability Link 1? (colour blindness) -->
            <a href="About.html" onclick="">ColourBlindness</a>
            
            <!-- Accessability Link 2? (Enlarge Text) -->
            <a href="About.html" onclick="">Enlarge Text/ 1x</a>
            
            <!-- Accessability Link 2? (Enlarge Text) -->
            <a href="About.html" onclick="">Shrink Text/ 1x</a>
            
            <!-- Accessability Link 2? (Enlarge Text) -->
            <a href="About.html" onclick="">Reset Text</a>
        </div>
        </div>
    </footer>
</body>

<script>
    
        function navHome(){
        window.location.href = "./Home.html";
    }
            //Onload function extracts user submitted postcode from url and creates a request
            //if an authentic postcode, the remainder of the script is executed via success.
            //if an unauthentic postcode or request error, user is sent back to homepage.
            $(function() 
            {

            var request = "https://api.postcodes.io/scotland/postcodes/";
            var submitPostcode = document.URL;

            var conCode;
            var conId;

            var personId;
            var personrequest = "https://data.parliament.scot/api/members/";

            submitPostcode = submitPostcode.substr(submitPostcode.indexOf("=") +1,submitPostcode.length);
            request = request + submitPostcode;

            //Constituency in relation to postcode, stores constituency code
            $.ajax({

                url: request,
                type: "get",
                dataType: "json",
                success: function(data) 
                {
                    x = data.result;
                    conCode = data.result.codes["scottish_parliamentary_constituency"];
                    document.getElementById("ConName").innerHTML = x["scottish_parliamentary_constituency"];
                },
                error: function()
                {
                    window.location.href = "./Home.html#ErrorMessage";
                }
                    
            });

            //searches for same constituancy, gets constituency id according to parlament.scot
            $.ajax({

                url: "https://data.parliament.scot/api/constituencies/",
                type: "get",
                dataType: "json",
                success: function(data) 
                {
                    $.each(data, function(i,field){
                        if(field.ConstituencyCode == conCode)
                        {
                            conId = field.ID;
                        }
                    })
                },
                error: function()
                {
                    window.location.href = "./Home.html#ErrorMessage";
                }
    
            });

            //searches for person id with matching constituency id
            $.ajax({

                url: "https://data.parliament.scot/api/MemberElectionConstituencyStatuses/",
                type: "get",
                dataType: "json",
                success: function(data) 
                {

                    $.each(data, function(i,field){
                        if(field.ConstituencyID == conId)
                        {
                            personId = field.PersonID;

                        }
                    })

                    personrequest = personrequest.concat(personId.toString());
                    console.log(personrequest);

                    $.ajax({

                            url: personrequest,
                            type: "get",
                            dataType: "json",
                            success: function(data) 
                            {
                                console.log(data);
                                if(data.IsCurrent == true)
                                {
                                    document.getElementById("MspName").innerHTML = data.ParliamentaryName;
                                    document.getElementById("MspParty").innerHTML = "MSP: " + data.ParliamentaryName;
                                    document.getElementById("MspEmail").innerHTML = "MSP: " + data.ParliamentaryName;
                                    document.getElementById("MspTele").innerHTML = "MSP: " + data.ParliamentaryName;
                                    document.getElementById("MspImage").innerHTML = "<img src= " + data.PhotoURL + " width=300 height=300 alt=PhotoNotFound>";
                                }
                                else
                                {
                                    document.getElementById("MspName").innerHTML = "No elect MSP found";
                                    document.getElementById("MspImage").innerHTML = "No elect MSP found";
                                }

                            },
                            error: function()
                            {
                                window.location.href = "./Home.html#ErrorMessage";
                            }

                    });

                },
                error: function()
                {
                    window.location.href = "./Home.html#ErrorMessage";
                }

            });

            });

            //  https://data.parliament.scot/api/constituencies/  S16000122  get ID = 90
            //  https://data.parliament.scot/api/MemberElectionConstituencyStatuses/ where constituencies id = 90 get personid =1848
            //  https://data.parliament.scot/api/members/1848 where personid
</script>
    
</html>